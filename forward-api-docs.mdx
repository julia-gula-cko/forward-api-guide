---
title: Forward stored credentials
account: NAS
description: Enrich a payment request with payment credentials you've stored with Checkout.com, and forward the request to a third-party API endpoint.
lastUpdated: December 3, 2025
isEarlyAccess: true
---

Use the [Forward API](https://api-reference.checkout.com/#tag/Forward) to enrich a payment request with payment credentials you've stored in the [Checkout.com Vault](/payments/accept-payments/accept-a-payment-on-your-website/extend-your-flow-integration/accept-payments-with-stored-card-credentials). You can enrich a payment with:

- The billing information stored in a payment instrument or token
- The card details stored in an instrument or token
- The details of a network token

The request is then securely forwarded to your specified third-party API endpoint.
For example, you can forward the request to external fraud engines, [3D Secure (3DS)](/payments/authenticate-payments/3d-secure) engines, and other payment services providers (PSPs) such as [Stripe](#Stripe_forwarding_example) or [Adyen](#Adyen_forwarding_example).

<TipBox variant="info">

To enable forwarding, contact your account manager or [request support](https://dashboard.checkout.com/support/new?topic=case_configuration_change&issue=case_configuration_issue_operational_change_request).

</TipBox>

This enables you to:

- Store payment credentials in a single location and use them across multiple PSPs, while remaining [PCI compliant](/business-operations/ensure-regulatory-compliance/pci-compliance).
- Provide additional data to third-party fraud engines.
- Extract stored payment credentials from one client's vault and forward them to another client's vault, if you have a multi-client account structure.
- Provide card-linked offers to an issuer or card network.

<TipBox variant="info">

You must ensure that the third-party endpoint you forward the request to belongs to a PCI-compliant entity.

</TipBox>

---

## Retrieve JSON Web Key

You need Checkout.com's JSON Web Key (JWK) to encrypt sensitive request headers using JSON Web Encryption (JWE).

In your terminal, run the following command to retrieve our JWK:

```curl
curl --location 'https://forward.checkout.com/.well-known/jwks' \
--header 'Content-Type: application/json' \
```

---

## Retrieve the instrument, token, or network token

Before you can create a forward request, retrieve the ID for the source of the stored credentials. This can be one of:

- A [payment instrument](/payments/store-and-manage-credentials/store-credentials/payment-instruments) ID you've created and stored in the Vault, prefixed with `src_`
- A [token](https://api-reference.checkout.com/#tag/Tokens) ID you've generated, prefixed with `tok_`

<TipBox variant="info">

Tokens expire after 15 minutes. If you want to reuse the credentials in future payments, you can [convert a token into a payment instrument](https://api-reference.checkout.com/#operation/createAnInstrument).

</TipBox>

---

## Create a forward request

Call the [Forward an API request](https://api-reference.checkout.com/#operation/forwardRequest) endpoint.

Authenticate the request using one of the following:
- Public key – If using an API key, we recommend encrypting it first.
- An API key
- An access key – If using [OAuth 2.0 authentication](/developer-resources/api/manage-api-keys/oauth-2-0-client-credentials)

<TipBox variant="note">

Checkout.com does not store the API keys you provide in encrypted headers. We only use the key to process the request in which it's provided.

</TipBox>

In the request body, provide the following:

<Tabs>
<Tab title="Payment instrument">

For a payment instrument or a network token stored as a payment instrument:

- `source.type` – Set to `id`.
- `source.id` – The payment instrument ID, prefixed with `src_`
- `destination_request.url` – The third-party endpoint you want to forward the request to
- `destination_request.method` – The HTTP method you want to use for the request
- `destination_request.headers.raw` – The raw HTTP headers you want to include in the request
- `destination_request.body` – The JSON payload formatted according to the key-value pairs expected by the destination PSP

Optionally:

- `source.cvv_token` – The token ID for the card verification value (CVV), prefixed with `tok_`
- `source.pin_token` – The token ID for the card's personal identification number (PIN), prefixed with `tok_`

</Tab>

<Tab title="Token">

For a temporarily tokenized payment method:

- `source.type` – Set to `token`.
- `source.token` – The token ID, prefixed with `tok_`
- `destination_request.url` – The third-party endpoint you want to forward the request to
- `destination_request.method` – The HTTP method you want to use for the request
- `destination_request.headers.raw` – The raw HTTP headers you want to include in the request
- `destination_request.body` – The JSON payload formatted according to the key-value pairs expected by the destination PSP

Optionally:
- `source.store_for_future_use` – Store the token as a payment instrument.

</Tab>
</Tabs>

### Using network tokens

Network tokens enhance transaction security by replacing raw card details. This helps ensure compliance with PCI DSS standards and reduces the risk of fraud.

To process a request which includes network tokens, you must include the [forwarding logic](#Forwarding_logic) that checks they're available and the required fields to forward.

- Set the `network_token.enabled` field to `true`.
- Set the `network_token.request_cryptogram` field to:
    - `true` – For customer-initiated transactions (CITs)
    - `false` – For merchant-initiated transactions (MITs)

If a network token is unavailable, the Forward API falls back to using tokenized card details.

### Placeholder values

You can use the following placeholder values in the `destination_request.body` field.

When the request is forwarded to the third-party endpoint, the placeholder values are replaced with the respective payment credentials stored in the specified payment instrument or token.

When you set `network_token.enabled` to `true`, the Forward API checks if a network token is available for the instrument.
If a token is available and you also set `request_cryptogram` to `true`, the API also requests a new cryptogram.
The token values then become available to use as placeholders in your request body.

<Tabs>
<Tab title="Card details">
<Table>
<TableHead headers={['Placeholder value', 'Description']} sizes={['40%', '60%']} />
<TableBody>
<TableRow>
<TableCell>

`{{card_cvv}}`

</TableCell>
<TableCell>

The card verification value.

<InfoBox>This is also referred to as the card's security code.</InfoBox>

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{card_expiry_month}}`

</TableCell>
<TableCell>

The card's expiry month. <br/>
Format – `MM`

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{card_expiry_year_yy}}`

</TableCell>
<TableCell>

The card's expiry year. <br/>
Format – `YY`

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{card_expiry_year_yyyy}}`

</TableCell>
<TableCell>

The card's expiry year. <br/>
Format – `YYYY`

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{card_number}}`

</TableCell>
<TableCell>

The full card number.

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{card_pin}}`

</TableCell>
<TableCell>

The first two digits of the card's PIN.

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{cardholder_name}}`

</TableCell>
<TableCell>

The cardholder's name as shown on the card.

</TableCell>
</TableRow>
</TableBody>
</Table>
</Tab>
<Tab title="Billing information">
<Table>
<TableHead headers={['Placeholder value', 'Description']} sizes={['40%', '60%']} />
<TableBody>
<TableRow>
<TableCell>

`{{billing_address_city}}`

</TableCell>
<TableCell>

The city of the billing address.

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{billing_address_country}}`

</TableCell>
<TableCell>

The country of the billing address.

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{billing_address_line1}}`

</TableCell>
<TableCell>

The first line of the billing address.

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{billing_address_line2}}`

</TableCell>
<TableCell>

The second line of the billing address.

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{billing_address_state}}`

</TableCell>
<TableCell>

The state of the billing address.

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{billing_address_zip}}`

</TableCell>
<TableCell>

The ZIP code or post code of the billing address.

</TableCell>
</TableRow>
</TableBody>
</Table>
</Tab>
<Tab title="Network token details">
<Table>
<TableHead headers={['Placeholder value', 'Description']} sizes={['40%', '60%']} />
<TableBody>
<TableRow>
<TableCell>

`{{network_token_number}}`

</TableCell>
<TableCell>

The network token number from the card scheme.

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{network_token_type}}`

</TableCell>
<TableCell>

The type of network token. This can be one of:

- `mdes` for Mastercard
- `vts` for Visa

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{network_token_cryptogram}}`

</TableCell>
<TableCell>

The token authentication verification value (TAVV). This is also referred to as a one-time cryptogram.

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{network_token_eci}}`

</TableCell>
<TableCell>

The [Electronic Commerce Indicator (ECI)](/developer-resources/codes/eci-values) received from the issuer.

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{network_token_expiry_year_yy}}`

</TableCell>
<TableCell>

The network token's expiry year. <br/>
Format – `YY`

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{network_token_expiry_year_yyyy}}`

</TableCell>
<TableCell>

The network token's expiry year <br/>
Format – `YYYY`

</TableCell>
</TableRow>
<TableRow>
<TableCell>

`{{network_token_expiry_month}}`

</TableCell>
<TableCell>

The network token's expiry month <br/>
Format – `MM`

</TableCell>
</TableRow>
</TableBody>
</Table>
</Tab>
</Tabs>

<TipBox variant="info">

If you use the Forward API to perform an authorization with a third party, you must handle any post-transaction actions directly with them. For example, captures, refunds, and disputes.

</TipBox>

<Tabs>
<Tab title='Production'>
<APILineCodeWrapper type="post">

`https://forward.checkout.com/forward`

</APILineCodeWrapper>
</Tab>
<Tab title='Sandbox'>
<APILineCodeWrapper type="post">

`https://forward.sandbox.checkout.com/forward`

</APILineCodeWrapper>
</Tab>
</Tabs>

### Request example

```json
{
  "source": {
    "type": "id",
    "id": "src_wmlfc3zyhqzehihu7giusaaawu"
  },
  "reference": "ORD-5023-4E89",
  "processing_channel_id": "pc_azsiyswl7bwe2ynjzujy7lcjca",
  "destination_request": {
    "url": "string",
    "method": "POST",
    "headers": {
      "encrypted": "<JWE encrypted key-value object>",
      "raw": {
        "Idempotency-Key": "xe4fad12367dfgrds",
        "Content-Type": "application/json"
      }
    },
    "body": "{\"amount\": 1000,\"currency\": \"USD\",\"reference\": \"Test\",\"source\": {\"type\": \"card\",\"number\": \"{{card_number}}\",\"expiry_month\": \"{{card_expiry_month}}\",\"expiry_year\": \"{{card_expiry_year_yyyy}}\",\"name\": \"John Smith\"},\"payment_type\": \"Regular\",\"authorization_type\": \"Final\",\"capture\": true,\"processing_channel_id\": \"pc_xxxxxxxxxxx\",\"risk\": {\"enabled\": false},\"merchant_initiated\": true}"
  }
}
```

### Response example

```json
{
  "request_id": "fwd_5fa7ee8c-f82d-4440-a6dc-e8c859b03235",
  "destination_response": {
    "status": 201,
    "headers": {
      "Cko-Request-Id": "5fa7ee8c-f82d-4440-a6dc-e8c859b03235",
      "Content-Type": "application/json"
    },
    "body": "{ \n \"id\": \"pay_mbabizu24mvu3mela5njyhpit4\", \n \"action_id\": \"act_mbabizu24mvu3mela5njyhpit4\", \n \"amount\": 6540,\"currency\": \"USD\", \n \"approved\": true,\"status\": \"Authorized\", \n \"auth_code\": \"770687\", \n \"response_code\": \"10000\", \n \"response_summary\": \"Approved\", \n \"_links\": \n {\"self\": \n {\"href\": \"https://api.sandbox.checkout.com/payments/pay_mbabizu24mvu3mela5njyhpit4\"}, \n \"action\": \n {\"href\": \"https://api.sandbox.checkout.com/payments/pay_mbabizu24mvu3mela5njyhpit4/actions\"}, \n \"void\": \n {\"href\": \"https://api.sandbox.checkout.com/payments/pay_mbabizu24mvu3mela5njyhpit4/voids\"}, \n \"capture\": \n {\"href\": \"https://api.sandbox.checkout.com/payments/pay_mbabizu24mvu3mela5njyhpit4/captures\"}\n}\n}"
  }
}
```

If you receive a `200` response, the request was successfully forwarded to the specified third-party endpoint.

The `response.status` field specifies the response code returned by the third-party endpoint.

The `response.body` field contains the response body returned by the third-party endpoint, with any sensitive PCI information removed.

<TipBox variant="note">

Checkout.com cannot guarantee that the third-party processor will return a specific response to any requests you forward. If they are unresponsive, you must contact them directly to resolve the issue.

</TipBox>

---

## Building requests

You can use variables, query parameters, and JWE encryption to build complex requests for your destination endpoints.

### Variables

Variables allow you to define reusable values that can be referenced throughout your request. They are processed before the request body, headers, and query parameters, making them ideal for building complex data structures or combining multiple values.

Variables are defined in the `variables` array within your `destination_request`. Each variable has a `name` and a `value`. Once defined, you can reference them anywhere in your request using the syntax `{{ variable_name }}`.

<TipBox variant="info">

Variables are processed first, so they can be used in the body, headers, and query parameters.

</TipBox>

#### Request example

```json
{
  "source": {
    "type": "id",
    "id": "src_xxxxxxxxxxxxxxxxxxxxxxxxxx"
  },
  "reference": "your-reference",
  "processing_channel_id": "pc_xxxxxxxxxxxxxxxxxxxxxxxxxx",
  "destination_request": {
    "url": "https://api.example.com/v1/endpoint",
    "method": "POST",
    "headers": {
      "raw": {
        "Content-Type": "application/json",
        "X-Expiry-Date": "{{ formatted_expiry }}"
      }
    },
    "body": "{ \"card\": { \"number\": \"{{ card_number }}\", \"expiry\": \"{{ formatted_expiry }}\", \"cvv\": \"{{ card_cvv }}\" }, \"cardData\": \"{{ card_payload }}\" }",
    "variables": [
      {
        "name": "formatted_expiry",
        "value": "{{ card_expiry_month }}/{{ card_expiry_year_yy }}"
      },
      {
        "name": "card_payload",
        "value": "{\"pan\":\"{{ card_number }}\",\"expiryMonth\":\"{{ card_expiry_month }}\",\"expiryYear\":\"{{ card_expiry_year_yyyy }}\"}"
      }
    ]
  }
}
```

### Query parameters

Query parameters allow you to append key-value pairs to your destination URL. They are automatically appended to the URL when the request is sent to the destination.

Query parameters are defined in the `query` array within your `destination_request`. Each parameter has a `name` and a `value`. You can use static values or template expressions to inject dynamic values.

For example, if your destination URL is `https://api.example.com/v1/charges` and you define query parameters, the final URL becomes `https://api.example.com/v1/charges?merchantId=12345&version=2024-01&cardBin=411111`.

#### Request example

```json
{
  "source": {
    "type": "id",
    "id": "src_xxxxxxxxxxxxxxxxxxxxxxxxxx"
  },
  "reference": "your-reference",
  "processing_channel_id": "pc_xxxxxxxxxxxxxxxxxxxxxxxxxx",
  "destination_request": {
    "url": "https://api.example.com/v1/charges",
    "method": "POST",
    "headers": {
      "raw": {
        "Content-Type": "application/json"
      }
    },
    "body": "{ \"amount\": 1000, \"currency\": \"USD\" }",
    "variables": [
      {
        "name": "card_bin",
        "value": "{{ card_number }}"
      }
    ],
    "query": [
      {
        "name": "merchantId",
        "value": "12345"
      },
      {
        "name": "version",
        "value": "2024-01"
      },
      {
        "name": "cardBin",
        "value": "{{ card_bin }}"
      },
      {
        "name": "expiryYear",
        "value": "{{ card_expiry_year_yyyy }}"
      }
    ]
  }
}
```

### JWE encryption

JWE (JSON Web Encryption) allows you to encrypt sensitive data within your request using a public or symmetric key.

The `jwe_encrypt` function is available within your templates:

```
{{ jwe_encrypt(data=data_to_encrypt, key=encryption_key, alg='RSA-OAEP', enc='A256GCM', headers=custom_headers) }}
```

<Table>
<TableHead headers={['Parameter', 'Description', 'Example values']} sizes={['20%', '50%', '30%']} />
<TableBody>
<TableRow>
<TableCell>`data`</TableCell>
<TableCell>The data to encrypt, typically a variable containing card data.</TableCell>
<TableCell>`card_payload`</TableCell>
</TableRow>
<TableRow>
<TableCell>`key`</TableCell>
<TableCell>The encryption key in JWK format (RSA public key or symmetric key).</TableCell>
<TableCell>`jwk_key`</TableCell>
</TableRow>
<TableRow>
<TableCell>`alg`</TableCell>
<TableCell>Key encryption algorithm.</TableCell>
<TableCell>`RSA-OAEP`, `RSA-OAEP-256`, `A256GCMKW`</TableCell>
</TableRow>
<TableRow>
<TableCell>`enc`</TableCell>
<TableCell>Content encryption algorithm.</TableCell>
<TableCell>`A256GCM`, `A128GCM`, `A256CBC-HS512`</TableCell>
</TableRow>
<TableRow>
<TableCell>`headers`</TableCell>
<TableCell>(Optional) Additional JWE headers as JSON.</TableCell>
<TableCell>`{"kid":"key-id","iat":1234567890}`</TableCell>
</TableRow>
</TableBody>
</Table>

#### Supported algorithms

<Table>
<TableHead headers={['Algorithm type', 'Supported values']} sizes={['30%', '70%']} />
<TableBody>
<TableRow>
<TableCell>Key encryption</TableCell>
<TableCell>`RSA-OAEP`, `RSA-OAEP-256`, `A256GCMKW`</TableCell>
</TableRow>
<TableRow>
<TableCell>Content encryption</TableCell>
<TableCell>`A128GCM`, `A256GCM`, `A128CBC-HS256`, `A256CBC-HS512`</TableCell>
</TableRow>
</TableBody>
</Table>

#### Using asymmetric key encryption

For RSA-based encryption, provide the public key in JWK format:

```json
{
  "source": {
    "type": "id",
    "id": "src_xxxxxxxxxxxxxxxxxxxxxxxxxx"
  },
  "reference": "your-reference",
  "processing_channel_id": "pc_xxxxxxxxxxxxxxxxxxxxxxxxxx",
  "destination_request": {
    "url": "https://api.example.com/v1/endpoint",
    "method": "POST",
    "headers": {
      "raw": {
        "Content-Type": "application/json"
      }
    },
    "body": "{ \"encryptedCard\": \"{{ jwe_encrypt(data=card_data, key=public_key, alg='RSA-OAEP', enc='A256GCM') }}\"}",
    "variables": [
      {
        "name": "card_data",
        "value": "{\"primaryAccountNumber\":\"{{ card_number }}\",\"panExpirationMonth\":\"{{ card_expiry_month }}\",\"panExpirationYear\":\"{{ card_expiry_year_yyyy }}\",\"cvv\":\"{{ card_cvv }}\"}"
      },
      {
        "name": "public_key",
        "value": "{ \"kty\": \"RSA\", \"e\": \"AQAB\", \"use\": \"enc\", \"kid\": \"key-001\", \"alg\": \"RSA-OAEP\", \"n\": \"your-public-key-modulus\" }"
      }
    ]
  }
}
```

#### Using symmetric key encryption

For destinations that require symmetric key encryption, use algorithms like `A256GCMKW`. This requires a 256-bit (32 bytes) symmetric key encoded in base64url format.

The symmetric key must be provided as a JWK with the `k` parameter containing the base64url-encoded key:

```json
{
  "kty": "oct",
  "k": "<base64url-encoded-256-bit-key>"
}
```

<TipBox variant="note">

Some APIs require the key to be derived as `base64url(sha256(<shared-secret>))`. Check your destination API documentation for the exact key derivation requirements.

</TipBox>

```json
{
  "source": {
    "type": "id",
    "id": "src_xxxxxxxxxxxxxxxxxxxxxxxxxx"
  },
  "reference": "your-reference",
  "processing_channel_id": "pc_xxxxxxxxxxxxxxxxxxxxxxxxxx",
  "destination_request": {
    "url": "https://api.example.com/v1/tokenize",
    "method": "POST",
    "headers": {
      "raw": {
        "Content-Type": "application/json"
      }
    },
    "body": "{ \"encryptedPayload\": \"{{ jwe_encrypt(data=payment_data, key=symmetric_key, alg='A256GCMKW', enc='A256GCM', headers=jwe_headers) }}\"}",
    "variables": [
      {
        "name": "payment_data",
        "value": "{\"accountNumber\":\"{{ card_number }}\",\"expirationMonth\":\"{{ card_expiry_month }}\",\"expirationYear\":\"{{ card_expiry_year_yyyy }}\"}"
      },
      {
        "name": "symmetric_key",
        "value": "{ \"kty\": \"oct\", \"k\": \"<your-base64url-encoded-256-bit-key>\" }"
      },
      {
        "name": "jwe_headers",
        "value": "{ \"kid\": \"your-key-id\", \"iat\": 1234567890 }"
      }
    ]
  }
}
```

#### How it works

1. **Define the data to encrypt** – Create a variable (`card_data`) containing the JSON payload with card details.
2. **Define the encryption key** – Create a variable (`public_key` or `symmetric_key`) with the JWK key provided by the destination.
3. **Call the function** – Use `jwe_encrypt(data=card_data, key=public_key, alg='RSA-OAEP', enc='A256GCM')` in your body template.
4. **Result** – The function returns the encrypted JWE token string that replaces the placeholder.

---

## Secrets in Forward API

The Forward API allows you to securely store and manage sensitive data such as credentials, API keys, and encryption keys. You can reference these secrets in your requests without exposing them in the request payload.

### Storing secrets

Store a secret by providing a unique name and the sensitive value.

<Tabs>
<Tab title='Production'>
<APILineCodeWrapper type="post">

`https://forward.checkout.com/secrets`

</APILineCodeWrapper>
</Tab>
<Tab title='Sandbox'>
<APILineCodeWrapper type="post">

`https://forward.sandbox.checkout.com/secrets`

</APILineCodeWrapper>
</Tab>
</Tabs>

#### Request example

```json
{
  "name": "my-api-key",
  "value": "sk_live_xxxxxxxxxxxxxxxxxxxxx"
}
```

#### Response example

```json
{
  "id": "sec_xxxxxxxxxxxxxxxxxxxxxxxxxx",
  "name": "my-api-key",
  "created_at": "2024-01-15T10:30:00Z"
}
```

### Using secrets in requests

Once a secret is stored, you can reference it in your Forward API requests using the `{{ secret_<secret_name> }}` syntax. The secret value is securely injected at runtime.

<Table>
<TableHead headers={['Syntax', 'Description', 'Example']} sizes={['30%', '40%', '30%']} />
<TableBody>
<TableRow>
<TableCell>`{{ secret_<name> }}`</TableCell>
<TableCell>References a stored secret by its name.</TableCell>
<TableCell>`{{ secret_my-api-key }}`</TableCell>
</TableRow>
</TableBody>
</Table>

#### Using a stored API key in headers

```json
{
  "source": {
    "type": "id",
    "id": "src_xxxxxxxxxxxxxxxxxxxxxxxxxx"
  },
  "reference": "your-reference",
  "processing_channel_id": "pc_xxxxxxxxxxxxxxxxxxxxxxxxxx",
  "destination_request": {
    "url": "https://api.example.com/v1/charges",
    "method": "POST",
    "headers": {
      "raw": {
        "Content-Type": "application/json",
        "Authorization": "{{ secret_destination-api-key }}"
      }
    },
    "body": "{ \"amount\": 1000, \"currency\": \"USD\", \"card\": { \"number\": \"{{ card_number }}\", \"expiry_month\": \"{{ card_expiry_month }}\", \"expiry_year\": \"{{ card_expiry_year_yyyy }}\", \"cvv\": \"{{ card_cvv }}\" } }"
  }
}
```

#### Using a stored encryption key with JWE

You can reference secrets within variables to use them with functions like `jwe_encrypt`:

```json
{
  "source": {
    "type": "id",
    "id": "src_xxxxxxxxxxxxxxxxxxxxxxxxxx"
  },
  "reference": "your-reference",
  "processing_channel_id": "pc_xxxxxxxxxxxxxxxxxxxxxxxxxx",
  "destination_request": {
    "url": "https://api.example.com/v1/tokenize",
    "method": "POST",
    "headers": {
      "raw": {
        "Content-Type": "application/json"
      }
    },
    "body": "{ \"encryptedCard\": \"{{ jwe_encrypt(data=card_data, key=encryption_key, alg='RSA-OAEP', enc='A256GCM') }}\"}",
    "variables": [
      {
        "name": "card_data",
        "value": "{\"primaryAccountNumber\":\"{{ card_number }}\",\"panExpirationMonth\":\"{{ card_expiry_month }}\",\"panExpirationYear\":\"{{ card_expiry_year_yyyy }}\"}"
      },
      {
        "name": "encryption_key",
        "value": "{{ secret_partner-public-key }}"
      }
    ]
  }
}
```

---

## Forwarding logic

The fields forwarded to the third-party endpoint depend on the type of request:

- [CIT using network token and cryptogram](#CIT_using_network_token_and_cryptogram)
- [MIT using network token](#MIT_using_network_token)
- [Network token only](#Network_token_only)

### CIT using a network token and cryptogram

If you set `network_token.request_cryptogram` to `true` and the network token and cryptogram are available, the following values are forwarded:

- `network_token_number`
- `network_token_expiry_month`
- `network_token_expiry_year_yyyy`, or `network_token_expiry_year_yy`
- `network_token_type`
- `network_token_cryptogram`
- `network_token_eci`

<Tabs>
<Tab title='Production'>
<APILineCodeWrapper type="post">

`https://forward.checkout.com/forward`

</APILineCodeWrapper>
</Tab>
<Tab title='Sandbox'>
<APILineCodeWrapper type="post">

`https://forward.sandbox.checkout.com/forward`

</APILineCodeWrapper>
</Tab>
</Tabs>

#### Request example

```json
{
 "source": {
   "type": "id",
   "id": "src_5i3imssmshlu5apj2sgdozyht4"
 },
 "processing_channel_id": "pc_cvbbk7dyapdeho2qmuzozupapi",
 "network_token": {
    "enabled" : true,
    "request_cryptogram": true
 },
 "destination_request": {
   "url": "https://api.stripe.com/v1/payment_methods",
   "method": "POST",
   "headers": {
     "raw": {
     }
   },
   "body": "{ \n \"source\": \n {\"type\": \"network_token\", \n \"token\": \"{{network_token_number}}\", \n \"expiry_month\": \"{{network_token_expiry_month}}\", \n \"expiry_year\": \"{{network_token_expiry_year_yyyy}}\", \n \"token_type\": \"{{network_token_type}}\", \n \"cryptogram\": \"{{network_token_cryptogram}}\", \n \"eci\": \"{{network_token_eci}}\"}, \n \"amount\": 200, \n \"currency\": \"CHF\", \n \"capture\": true, \n \"processing_channel_id\" :\"pc_cvbbk7dyapdeho2qmuzozupapi\"}"
 }
}
```

### MIT using a network token

If you set `network_token.request_cryptogram` to `false`, the following values are forwarded:

- `network_token_number`
- `network_token_expiry_month`
- `network_token_expiry_year_yyyy`, or `network_token_expiry_year_yy`
- `network_token_type`

<Tabs>
<Tab title='Production'>
<APILineCodeWrapper type="post">

`https://forward.checkout.com/forward`

</APILineCodeWrapper>
</Tab>
<Tab title='Sandbox'>
<APILineCodeWrapper type="post">

`https://forward.sandbox.checkout.com/forward`

</APILineCodeWrapper>
</Tab>
</Tabs>

#### Request example

```json
{
 "source": {
   "type": "id",
   "id": "src_5i3imssmshlu5apj2sgdozyht4"
 },
 "processing_channel_id": "pc_cvbbk7dyapdeho2qmuzozupapi",
 "network_token": {
    "enabled" : true,
    "request_cryptogram": false
 },
 "destination_request": {
   "url": "https://api.stripe.com/v1/payment_methods",
   "method": "POST",
   "headers": {
     "raw": {
     }
   },
   "body": "{ \n \"source\": { \n\"type\": \"network_token\", \n\"token\": \"{{network_token_number}}\", \n\"expiry_month\": \"{{network_token_expiry_month}}\", \n\"expiry_year\": \"{{network_token_expiry_year_yyyy}}\", \n\"token_type\": \"{{network_token_type}}\", \n\"previous_payment_id\": 1923712462419 \n}, \n\"amount\": 200, \n\"currency\": \"CHF\", \n\"capture\": true, \n \"processing_channel_id\" :\"pc_cvbbk7dyapdeho2qmuzozupapi\" \n}"
 }
}
```
### Network token only

If you set `body.source.is_network_token_available` to `true` and the network token and cryptogram are available, the following values are forwarded:

- `network_token_number`
- `network_token_expiry_month`
- `network_token_expiry_year_yyyy`, or `network_token_expiry_year_yy`
- `network_token_type`
- `network_token_cryptogram`
- `network_token_eci`

If the network token or cryptogram are unavailable, the following card detail values are used as a fallback:

- `card_number`
- `card_expiry_month`
- `card_expiry_year_yyyy`, or `card_expiry_year_yy`

<Tabs>
<Tab title='Production'>
<APILineCodeWrapper type="post">

`https://forward.checkout.com/forward`

</APILineCodeWrapper>
</Tab>
<Tab title='Sandbox'>
<APILineCodeWrapper type="post">

`https://forward.sandbox.checkout.com/forward`

</APILineCodeWrapper>
</Tab>
</Tabs>

#### Request example

<Tabs>
<Tab title="Network token and cryptogram available">

```json
{
    "source": {
        "type": "id",
        "id": "src_5i3imssmshlu5apj2sgdozyht4"
    },
    "processing_channel_id": "pc_cvbbk7dyapdeho2qmuzozupapi",
    "network_token": {
        "enabled": true,
        "request_cryptogram": true
    },
    "destination_request": {
        "url": "https://api.stripe.com/v1/payment_methods",
        "method": "POST",
        "headers": {
            "raw": {
                "Idempotency-Key": "xe4fad12367dfgrds",
                "Content-Type": "application/json"
            }
        },
        "body": "{ \n \"source\": { \n \"is_network_token_available\": true, \n \"type\": \"network_token\", \n \"token\": \"{{network_token_number}}\", \n \"expiry_month\": \"{{network_token_expiry_month}}\", \n \"expiry_year\": \"{{network_token_expiry_year_yyyy}}\", \n \"cryptogram\": \"{{network_token_cryptogram}}\", \n \"eci\": \"{{network_token_eci}}\", \n \"billing_address\": { \n \"address_line1\": \"123 High St.\", \n \"address_line2\": \"Flat 456\", \n \"city\": \"London\", \n \"state\": \"GB\", \n \"zip\": \"SW1A 1AA\", \n \"country\": \"GB\" \n } } }"
    }
}
```

</Tab>
<Tab title="Network token or cryptogram unavailable">

```json
{
  "source": {
      "type": "id",
      "id": "src_5i3imssmshlu5apj2sgdozyht4"
  },
  "processing_channel_id": "pc_cvbbk7dyapdeho2qmuzozupapi",
  "network_token": {
      "enabled": true,
      "request_cryptogram": true
  },
  "destination_request": {
        "url": "https://api.stripe.com/v1/payment_methods",
        "method": "POST",
        "headers": {
            "raw": {
                "Idempotency-Key": "xe4fad12367dfgrds",
                "Content-Type": "application/json"
            }
        },
        "body": "{\n \"source\": { \n \"is_network_token_available\": false, \n \"type\": \"card\", \n \"card_number\": \"{{card_number}}\", \n \"expiry_month\": \"{{card_expiry_month}}\", \n \"expiry_year\": \"{{card_expiry_year_yyyy}}\", \n \"billing_address\": { \n \"address_line1\": \"123 High St.\", \n \"address_line2\": \"Flat 456\", \n \"city\": \"London\", \n \"state\": \"GB\", \n \"zip\": \"SW1A 1AA\", \n \"country\": \"GB\" \n } \n }"
  }
}
```
</Tab>
</Tabs>

---

## Stripe forwarding example

To forward a payment request to Stripe, follow these steps:

1. Create a payment method.
2. Create a payment intent.
3. Confirm the payment intent.
4. Review the response.

### Create a payment method

If you're using the authorization header, we recommend you encrypt the value and provide it in the `destination_request.headers.encrypted` field in the request.

The Stripe API expects each key-value pair to be separated with an `&` character.

The `Content-Type` in the header must match the format of the content you send.

```curl
curl --location 'https://forward.sandbox.checkout.com/forward' \
--header 'Content-Type: application/json' \
--header 'Authorization: YOUR_OAUTH_TOKEN' \
--data '{
 "source": {
   "type": "id",
   "id": "src_u422hics5oouvix25ous63grcy"
 },
 "reference": "string",
 "processing_channel_id": "pc_f2vtqcmhgykurkorrnnpz3kneq",
 "destination_request": {
   "url": "https://api.stripe.com/v1/payment_methods",
   "method": "POST",
   "headers": {
     "encrypted": "",
     "raw": {
       "Content-Type": "application/x-www-form-urlencoded",
       "Authorization": "Basic c2tfdGVzdF8yNlBIZW05QWhKWnZVNjIzRGZFMXg0c2Q6",
       "Host":"api.stripe.com"
     }
   },
   "body": "type=card&card[number]={{card_number}}&card[exp_month]={{card_expiry_month}}&card[exp_year]={{card_expiry_year_yyyy}}&card[cvc]=314"
 }
}'
```

You receive a payment method ID, which you need to confirm the payment intent.

### Create a payment intent

```curl
curl --location 'https://forward.sandbox.checkout.com/forward' \
--header 'Content-Type: application/json' \
--header 'Authorization: YOUR_OAUTH_TOKEN' \
--data '{
 "source": {
   "type": "id",
   "id": "src_u422hics5oouvix25ous63grcy"
 },
 "reference": "string",
 "processing_channel_id": "pc_f2vtqcmhgykurkorrnnpz3kneq",
 "destination_request": {
   "url": "https://api.stripe.com/v1/payment_intents",
   "method": "POST",
   "headers": {
     "encrypted": {
     },
     "raw": {
       "Content-Type": "application/x-www-form-urlencoded",
       "Authorization": "Basic c2tfdGVzdF8yNlBIZW05QWhKWnZVNjIzRGZFMXg0c2Q6",
       "Host":"api.stripe.com"
     }
   },
   "body": "amount=1000&currency=usd&payment_method_types[]=card"
 }
}'
```

You receive a payment intent ID, which you need to confirm the payment intent.

### Confirm the payment intent

To confirm the payment intent, update the `destination_request.url` and `destination_request.body` fields with the payment method ID and payment intent ID.

```curl
curl --location 'https://forward.sandbox.checkout.com/forward' \
--header 'Content-Type: application/json' \
--header 'Authorization: YOUR_OAUTH_TOKEN' \
--data '{
 "source": {
   "type": "id",
   "id": "src_u422hics5oouvix25ous63grcy"
 },
 "reference": "string",
 "processing_channel_id": "pc_f2vtqcmhgykurkorrnnpz3kneq",
 "destination_request": {
   "url": "https://api.stripe.com/v1/payment_intents/<STRIPE PAYMENT INTENT ID>/confirm",
   "method": "POST",
   "headers": {
     "encrypted": {
     },
     "raw": {
       "Content-Type": "application/x-www-form-urlencoded",
       "Authorization": "Basic c2tfdGVzdF8yNlBIZW05QWhKWnZVNjIzRGZFMXg0c2Q6",
       "Host":"api.stripe.com"
     }
   },
   "body": "payment_method=<STRIPE PAYMENT METHOD ID>"
 }
}'
```

### Review the response

```json
{
  "request_id": "fwd_da32zq6rgymepl4sxiz3nnnicy",
  "destination_response": {
    "status": "ok",
    "headers": {
      "Server": [
        "nginx"
      ],
      "Date": [
        "Fri, 21 Jun 2024 16:48:37 GMT"
      ],
      "Connection": [
        "keep-alive"
      ],
      "Access-Control-Allow-Credentials": [
        "true"
      ],
      "Access-Control-Allow-Methods": [
        "GET,HEAD,PUT,PATCH,POST,DELETE"
      ],
      "Access-Control-Allow-Origin": [
        "*"
      ],
      "Access-Control-Expose-Headers": [
        "Request-Id, Stripe-Manage-Version, Stripe-Should-Retry, X-Stripe-External-Auth-Required, X-Stripe-Privileged-Session-Required"
      ],
      "Access-Control-Max-Age": [
        "300"
      ],
      "Cache-Control": [
        "no-store, no-cache"
      ],
      "Content-Security-Policy": [
        "report-uri https://q.stripe.com/csp-report?p=v1%2Fpayment_methods; block-all-mixed-content; default-src 'none'; base-uri 'none'; form-action 'none'; frame-ancestors 'none'; img-src 'self'; script-src 'self' 'report-sample'; style-src 'self'"
      ],
      "Cross-Origin-Opener-Policy-Report-Only": [
        "same-origin; report-to=\"coop\""
      ],
      "Idempotency-Key": [
        "b7c44bf5-aa75-4fb3-9c6e-ad17a3e003c3"
      ],
      "Original-Request": [
        "req_UT51MBBX26MSzC"
      ],
      "Report-To": [
        "{\"group\":\"coop\",\"max_age\":8640,\"endpoints\":[{\"url\":\"https://q.stripe.com/coop-report?s=payins-bapi-srv\"}],\"include_subdomains\":true}"
      ],
      "Reporting-Endpoints": [
        "coop=\"https://q.stripe.com/coop-report?s=payins-bapi-srv\""
      ],
      "Request-Id": [
        "req_UT51MBBX26MSzC"
      ],
      "Stripe-Should-Retry": [
        "false"
      ],
      "Stripe-Version": [
        "2024-04-10"
      ],
      "Vary": [
        "Origin"
      ],
      "X-Content-Type-Options": [
        "nosniff"
      ],
      "X-Stripe-Priority-Routing-Enabled": [
        "true"
      ],
      "X-Stripe-Routing-Context-Priority-Tier": [
        "api-testmode"
      ],
      "Strict-Transport-Security": [
        "max-age=63072000; includeSubDomains; preload"
      ]
  },
  "body": "{\n  \"id\": \"pm_1PUAdd2x6R10KRrhGCbuX0hq\",\n  \"object\": \"payment_method\",\n  \"allow_redisplay\": \"unspecified\",\n  \"billing_details\": {\n    \"address\": {\n      \"city\": null,\n      \"country\": null,\n      \"line1\": null,\n      \"line2\": null,\n      \"postal_code\": null,\n      \"state\": null\n    },\n    \"email\": null,\n    \"name\": null,\n    \"phone\": null\n  },\n  \"card\": {\n    \"brand\": \"visa\",\n    \"checks\": {\n      \"address_line1_check\": null,\n      \"address_postal_code_check\": null,\n      \"cvc_check\": \"unchecked\"\n    },\n    \"country\": \"US\",\n    \"display_brand\": \"visa\",\n    \"exp_month\": 3,\n    \"exp_year\": 2030,\n    \"fingerprint\": \"NXzK7YAyyprPKex2\",\n    \"funding\": \"credit\",\n    \"generated_from\": null,\n    \"last4\": \"1111\",\n    \"networks\": {\n      \"available\": [\n        \"visa\"\n      ],\n      \"preferred\": null\n    },\n    \"three_d_secure_usage\": {\n      \"supported\": true\n    },\n    \"wallet\": null\n  },\n  \"created\": 1718988517,\n  \"customer\": null,\n  \"livemode\": false,\n  \"metadata\": {},\n  \"type\": \"card\"\n}"
  }
}
```

---

## Adyen forwarding example

To forward a payment request to Adyen, follow these steps:

1. Create a payment.
2. Review the response.

### Create a payment

The Adyen API expects a JSON payload, without any blank spaces between the key-value pairs.
Provide the entire value in double quotes to ensure that single quotes are escaped correctly.

The `Content-Type` in the header must match the format of the content you send.

```json
{
  "source": {
    "type": "token",
    "token": "tok_zjri4ogrqjuudnhsr7ooq5z6pq"
  },
  "reference": "string",
  "processing_channel_id": "pc_f2vtqcmhgykurkorrnnpz3kneq",
  "destination_request": {
    "url": "https://checkout-test.adyen.com/v71/payments",
    "method": "POST",
    "headers": {
      "raw": {
        "Content-Type": "application/json",
        "X-API-KEY": "<ADYEN API KEY>"
      }
    },
    "body": "{\"amount\":{\"currency\":\"EUR\",\"value\":10},\"paymentMethod\":{\"type\":\"scheme\",\"encryptedCardNumber\":\"test_{{card_number}}\",\"encryptedExpiryMonth\":\"test_{{card_expiry_month}}\",\"encryptedExpiryYear\":\"test_{{card_expiry_year_yyyy}}\",\"encryptedSecurityCode\":\"test_737\"},\"reference\":\"my_reference\",\"merchantAccount\":\"PrizeTechnologyECOM\",\"returnUrl\":\"https://httpstat.us/\"}"
  }
}
```

### Review the response

```json
{
  "request_id": "fwd_jt72i7tsjfgergogie2qxzh7ei",
  "destination_response": {
    "status": "ok",
    "headers": {
      "traceparent": [
        "00-22b8dcd266e756081fc1f50019293cdd-f151c37ad9b00661-01"
      ],
      "Strict-Transport-Security": [
        "max-age=31536000"
      ],
      "X-Frame-Options": [
        "SAMEORIGIN"
      ],
      "X-Content-Type-Options": [
        "nosniff"
      ],
      "Set-Cookie": [
        "JSESSIONID=ED43C7B0865E2210929050D36DA7EAE6.7d99355f-347b-18a0-fa83-70c08e69704f_0; Path=/checkout; Secure; HttpOnly"
      ],
      "pspReference": [
        "NPJ9LM2B88B26675"
      ],
      "Transfer-Encoding": [
        "chunked"
      ],
      "Date": [
        "Fri, 21 Jun 2024 16:10:38 GMT"
      ]
    },
    "body": "{\"additionalData\":{\"scaExemptionRequested\":\"transactionRiskAnalysis\"},\"pspReference\":\"QXBP9RM6Q327DN65\",\"resultCode\":\"Authorised\",\"amount\":{\"currency\":\"EUR\",\"value\":10},\"merchantReference\":\"my_reference\",\"paymentMethod\":{\"brand\":\"visa\",\"type\":\"scheme\"}}"
  }
}
```

---

## View forward request outcomes

You can view the outcome of your forward requests in the Dashboard.

1. Sign in to the [Dashboard](https://dashboard.checkout.com).
2. Go to _Vault_ > _Credential forwarding_.

On this page you can view:
- The total number of forward requests
- The response rate for your forward requests
- A breakdown of the responses received from the destinations you forwarded the requests to
- A history of all forward requests you've sent

Select a specific forward request to open its details page. On this page you can view:

- The forward request ID
- The date and time you forwarded the request
- Information about the destination you forwarded the request to – for example, the destination endpoint, the response code received, and the response time
- Information about the HTTP request sent and the HTTP response received
- Information about the stored credentials that you forwarded – for example, the payment instrument ID, card scheme, or issuing country
